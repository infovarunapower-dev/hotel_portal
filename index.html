<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Hotel Management Portal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .cart-panel { transition: transform .3s ease, opacity .3s ease; }
    .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.45); display: none; align-items:center; justify-content:center; z-index:50; }
    .modal { background: white; border-radius: 10px; padding: 18px; max-width: 520px; width: 95%; box-shadow: 0 12px 30px rgba(0,0,0,0.12); }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-100 via-white to-blue-200 min-h-screen p-6">

  <!-- Home button (always shows main menu) -->
  <a id="homeBtn" href="index.html"
     class="fixed top-4 right-4 bg-white shadow-lg px-4 py-2 rounded-full border hover:bg-gray-100 transition">
    üè† Home
  </a>

  <!-- MAIN UI: shows main menu immediately -->
  <div id="mainPortal" class="flex flex-col items-center">
    <h1 id="welcomeText" class="text-3xl font-bold text-gray-800 mt-10 mb-6">Welcome, Guest</h1>

    <div id="mainMenu" class="grid grid-cols-1 md:grid-cols-3 gap-8 w-full max-w-4xl">
      <button onclick="showSection('housekeeping')" class="bg-white rounded-2xl p-8 shadow-lg hover:scale-105 transition text-center">
        üßπ<h2 class="text-xl font-semibold mt-2">Housekeeping</h2>
      </button>

      <button onclick="showSection('travel')" class="bg-white rounded-2xl p-8 shadow-lg hover:scale-105 transition text-center">
        üöó<h2 class="text-xl font-semibold mt-2">Travel</h2>
      </button>

      <button onclick="showSection('food')" class="bg-white rounded-2xl p-8 shadow-lg hover:scale-105 transition text-center">
        üçΩÔ∏è<h2 class="text-xl font-semibold mt-2">Food Menu</h2>
      </button>
    </div>

    <!-- Category panel -->
    <div id="categorySection" class="hidden w-full max-w-4xl bg-white p-8 mt-10 rounded-2xl shadow-xl relative">
      <h2 id="categoryTitle" class="text-2xl font-bold text-gray-800 mb-4"></h2>
      <div id="optionsList" class="flex flex-col gap-4 mb-6"></div>

      <!-- request form for non-food -->
      <form id="requestForm" class="space-y-4">
        <textarea id="requestDetails" placeholder="Additional details..." class="border w-full p-3 rounded-md"></textarea>

        <div class="flex gap-2">
          <button type="submit" class="bg-blue-500 text-white py-3 px-6 rounded-lg hover:bg-blue-600 flex-1">Submit Request</button>
          <button type="button" onclick="goBack()" class="text-gray-500 underline px-4 py-3">‚¨Ö Back</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Cart overlay & panel -->
  <div id="cartOverlay" class="fixed inset-0 z-40 hidden bg-black/40"></div>
  <aside id="cartPanel" class="cart-panel fixed top-0 right-0 h-full w-96 transform translate-x-full z-50 bg-white shadow-2xl p-6 overflow-auto">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-xl font-bold">üõí Your Cart</h3>
      <button id="closeCartBtn" class="text-gray-600 hover:text-black">Close</button>
    </div>
    <div id="cartItems" class="space-y-3 mb-4"></div>
    <div class="border-t pt-4">
      <div class="flex justify-between items-center mb-3">
        <span class="font-semibold">Subtotal</span>
        <span id="cartSubtotal" class="font-bold">‚Çπ0</span>
      </div>
      <div class="flex flex-col gap-2">
        <button id="placeOrderBtn" class="bg-blue-600 text-white py-3 rounded-md">Place Order</button>
        <button id="clearCartBtn" class="mt-2 bg-gray-200 text-gray-700 py-2 rounded-md">Clear Cart</button>
      </div>
    </div>
  </aside>

  <!-- Modal: room confirmation (reused for request and order) -->
  <div id="modalBackdrop" class="modal-backdrop">
    <div id="modalBox" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <!-- dynamic content injected -->
    </div>
  </div>

<script>
/* ============================
   Setup & sample menu seed
   ============================ */
(function ensureSampleMenu(){
  try {
    if(!localStorage.getItem('foodMenu')) {
      const sample = {
        "Breakfast":[{name:"Idli",price:"60"},{name:"Dosa",price:"80"}],
        "Lunch":[{name:"Veg Thali",price:"150"}],
        "Snacks":[{name:"French Fries",price:"120"}]
      };
      localStorage.setItem('foodMenu', JSON.stringify(sample));
    }
  } catch(e){
    console.error('seed menu failed', e);
  }
})();

/* Utility */
const $ = id => document.getElementById(id);

/* Globals */
let currentCategory = '';
let currentService = '';

/* SERVICES */
const services = {
  housekeeping: { title: 'üßπ Housekeeping Services', options: ['Room Cleaning','Laundry Service','Extra Towels','Room Supplies','Other Requests'] },
  travel: { title: 'üöó Travel Assistance', options: ['Airport Pickup','Local Cab','Tour Guide','Car Rental','Other Travel Help'] },
  food: { title: 'üçΩÔ∏è Food Menu', dynamic: true }
};

/* Show section */
function showSection(category){
  currentCategory = category;
  currentService = '';
  const section = services[category];
  if(!section) return console.error('unknown section', category);
  $('mainMenu').classList.add('hidden');
  $('categorySection').classList.remove('hidden');
  $('categoryTitle').innerText = section.title;
  const list = $('optionsList');
  list.innerHTML = '';

  if(section.dynamic){
    let menu = {};
    try { menu = JSON.parse(localStorage.getItem('foodMenu')||'{}'); } catch(e){ menu = {}; }
    if(!Object.keys(menu).length){ list.innerHTML = '<p class="text-gray-600">No food items available.</p>'; return; }
    Object.keys(menu).forEach(cat => {
      const h = document.createElement('h3'); h.className='text-lg font-bold text-gray-700 mt-6'; h.innerText = cat;
      list.appendChild(h);
      (menu[cat]||[]).forEach(item=>{
        const row = document.createElement('div');
        row.className='flex items-center justify-between bg-gray-100 p-4 rounded-lg';
        row.innerHTML = `
          <div>
            <div class="font-semibold">${item.name}</div>
            <div class="text-sm text-gray-600">‚Çπ${item.price}</div>
          </div>
          <button class="bg-green-600 text-white px-3 py-1 rounded add-cart">Add to Cart</button>
        `;
        row.querySelector('.add-cart').addEventListener('click', ()=>{ addToCart(item.name, Number(item.price)); });
        list.appendChild(row);
      });
    });
    return;
  }

  // non-food categories
  section.options.forEach(opt=>{
    const btn = document.createElement('button');
    btn.className = 'bg-gray-100 hover:bg-blue-100 font-semibold py-3 rounded-lg';
    btn.innerText = opt;
    btn.addEventListener('click', ()=>{
      currentService = opt;
      document.querySelectorAll('#optionsList button').forEach(b=>b.classList.remove('bg-blue-200'));
      btn.classList.add('bg-blue-200');
    });
    list.appendChild(btn);
  });
}

/* go back */
function goBack(){
  $('mainMenu').classList.remove('hidden');
  $('categorySection').classList.add('hidden');
}

/* ============================
   REQUEST SUBMISSION (non-food)
   - On Submit: show room-confirm modal
   - Room used only for this request (not saved)
   ============================ */
$('requestForm').addEventListener('submit', function(e){
  e.preventDefault();
  // capture details user entered
  const details = $('requestDetails').value.trim();
  // prepare request object template
  const requestTemplate = {
    type: currentCategory,
    service: currentService || 'General Request',
    name: 'Guest',
    room: '', // to be filled by modal
    details,
    status: 'Pending',
    assigned_to: '',
    time: new Date().toLocaleString()
  };

  // open modal to confirm room, then save
  openRoomModal({
    title: 'Confirm Room Number',
    hint: 'Enter your room number to confirm this request',
    confirmText: 'Confirm & Send',
    onConfirm: (roomValue) => {
      requestTemplate.room = roomValue;
      // Save request to localStorage
      const all = JSON.parse(localStorage.getItem('requests')||'[]');
      all.push(requestTemplate);
      localStorage.setItem('requests', JSON.stringify(all));
      // feedback
      closeModal();
      alert('Request submitted successfully!');
      // reset form and UI
      $('requestForm').reset();
      goBack();
    }
  });
});

/* ============================
   CART SYSTEM & ORDER FLOW
   - Place Order shows order summary + room modal (Option 2)
   - Room not saved permanently; cart cleared after order
   ============================ */

function getCart(){ try{ return JSON.parse(localStorage.getItem('cart')||'[]'); }catch(e){return[];} }
function setCart(c){ localStorage.setItem('cart', JSON.stringify(c)); }

const cartOverlay = $('cartOverlay');
const cartPanel = $('cartPanel');
const cartItemsEl = $('cartItems');
const cartSubtotalEl = $('cartSubtotal');

function renderCart(){
  const cart = getCart();
  cartItemsEl.innerHTML = '';
  if(!cart.length){ cartItemsEl.innerHTML = '<p class="text-gray-600">Cart is empty.</p>'; cartSubtotalEl.innerText='‚Çπ0'; return; }
  let subtotal = 0;
  cart.forEach((it,idx)=>{
    subtotal += it.price * it.qty;
    const div = document.createElement('div');
    div.className = 'flex justify-between bg-gray-100 p-3 rounded';
    div.innerHTML = `
      <div>
        <div class="font-semibold">${it.name}</div>
        <div class="text-sm text-gray-600">‚Çπ${it.price} √ó ${it.qty}</div>
      </div>
      <div class="flex items-center gap-2">
        <button class="px-2 bg-gray-200 dec" data-idx="${idx}">-</button>
        <div>${it.qty}</div>
        <button class="px-2 bg-gray-200 inc" data-idx="${idx}">+</button>
        <button class="text-red-600 del" data-idx="${idx}">Remove</button>
      </div>
    `;
    cartItemsEl.appendChild(div);
  });
  cartSubtotalEl.innerText = '‚Çπ' + subtotal;
}

function openCart(){ cartOverlay.classList.remove('hidden'); cartPanel.style.transform = 'translateX(0)'; renderCart(); }
function closeCart(){ cartOverlay.classList.add('hidden'); cartPanel.style.transform = 'translateX(100%)'; }

$('closeCartBtn').addEventListener('click', closeCart);
cartOverlay.addEventListener('click', closeCart);
$('clearCartBtn').addEventListener('click', ()=>{
  if(confirm('Clear cart?')){ setCart([]); renderCart(); }
});

// floating cart
(function addFloatCartButton(){
  const floatBtn = document.createElement('button');
  floatBtn.innerText = 'üõí Cart';
  floatBtn.className = 'fixed bottom-6 right-6 bg-blue-600 text-white px-4 py-3 rounded-full shadow-lg';
  floatBtn.onclick = openCart;
  document.body.appendChild(floatBtn);
})();

cartItemsEl.addEventListener('click', (e)=>{
  const t = e.target;
  if(t.classList.contains('inc') || t.classList.contains('dec') || t.classList.contains('del')){
    const idx = Number(t.dataset.idx);
    const cart = getCart();
    if(!cart[idx]) return;
    if(t.classList.contains('inc')) cart[idx].qty++;
    if(t.classList.contains('dec')) cart[idx].qty = Math.max(1, cart[idx].qty - 1);
    if(t.classList.contains('del')) cart.splice(idx,1);
    setCart(cart); renderCart();
  }
});

function addToCart(name, price){
  const cart = getCart();
  const found = cart.find(c => c.name === name && c.price === price);
  if(found) found.qty++;
  else cart.push({ name, price, qty:1 });
  setCart(cart);
  openCart();
}

/* Place order -> show summary modal (Option 2) */
$('placeOrderBtn').addEventListener('click', ()=>{
  const cart = getCart();
  if(!cart.length) return alert('Cart is empty.');

  // build summary HTML
  let subtotal = 0;
  const rows = cart.map(it => {
    subtotal += it.price * it.qty;
    return `<div class="flex justify-between py-1"><div>${it.name} √ó ${it.qty}</div><div>‚Çπ${it.price * it.qty}</div></div>`;
  }).join('');

  const summaryHTML = `
    <h3 id="modalTitle" class="text-xl font-semibold mb-3">Confirm Food Order</h3>
    <div class="mb-3 text-sm">${rows}</div>
    <div class="mb-3 font-bold">Total: ‚Çπ${subtotal}</div>
    <div class="mb-2"><label class="block small text-gray-600">Enter room number to confirm</label>
      <input id="orderRoomInput" type="number" class="w-full border p-2 rounded" placeholder="Room number" />
    </div>
    <div class="flex justify-end gap-2 mt-2">
      <button id="orderCancelBtn" class="px-3 py-2 rounded bg-gray-200">Cancel</button>
      <button id="orderConfirmBtn" class="px-3 py-2 rounded bg-blue-600 text-white">Confirm & Place Order</button>
    </div>
  `;

  openModal(summaryHTML);

  // wire modal buttons
  document.getElementById('orderCancelBtn').addEventListener('click', closeModal);
  document.getElementById('orderConfirmBtn').addEventListener('click', ()=>{
    const room = document.getElementById('orderRoomInput').value && document.getElementById('orderRoomInput').value.trim();
    if(!room) return alert('Please enter room number');
    // build order request
    const name = 'Guest';
    const details = cart.map(i => `${i.name} √ó${i.qty} (‚Çπ${i.price})`).join('; ');
    const total = cart.reduce((s,i) => s + i.qty * i.price, 0);
    const req = { type:'Food', service:'Food Order', name, room, details: `${details} ‚Äî Total: ‚Çπ${total}`, status:'Pending', assigned_to:'', time: new Date().toLocaleString() };
    const all = JSON.parse(localStorage.getItem('requests')||'[]'); all.push(req); localStorage.setItem('requests', JSON.stringify(all));
    closeModal();
    setCart([]); renderCart(); closeCart();
    alert('Order placed ‚Äî kitchen will prepare it shortly.');
  }, { once: true });
});

/* ============================
   Modal helpers
   - openRoomModal: custom modal asking room + confirm callback
   - openModal/closeModal: generic
   ============================ */
function openModal(html){
  $('modalBox').innerHTML = html;
  $('modalBackdrop').style.display = 'flex';
}
function closeModal(){
  $('modalBackdrop').style.display = 'none';
  $('modalBox').innerHTML = '';
}

/* openRoomModal options:
   { title, hint, confirmText, onConfirm(roomValue) }
*/
function openRoomModal(opts){
  const html = `
    <h3 id="modalTitle" class="text-xl font-semibold mb-3">${opts.title || 'Confirm Room'}</h3>
    <div class="mb-3 text-sm text-gray-700">${opts.hint || 'Please enter your room number to confirm'}</div>
    <input id="confirmRoomInput" type="number" class="w-full border p-2 rounded" placeholder="Room number" />
    <div class="flex justify-end gap-2 mt-3">
      <button id="roomCancelBtn" class="px-3 py-2 rounded bg-gray-200">Cancel</button>
      <button id="roomConfirmBtn" class="px-3 py-2 rounded bg-blue-600 text-white">${opts.confirmText || 'Confirm'}</button>
    </div>
  `;
  openModal(html);
  document.getElementById('roomCancelBtn').addEventListener('click', closeModal);
  document.getElementById('roomConfirmBtn').addEventListener('click', ()=>{
    const val = document.getElementById('confirmRoomInput').value && document.getElementById('confirmRoomInput').value.trim();
    if(!val) return alert('Please enter room number');
    // call confirm callback (do not store room)
    try { opts.onConfirm(val); } catch(e){ console.error(e); }
  }, { once:true });
}

/* ============================
   Init: attach show/hide and render cart
   ============================ */
document.addEventListener('DOMContentLoaded', ()=>{
  renderCart();
  // close cart btn already wired via ID references earlier
});

// Expose functions to window (for onclick attributes)
window.showSection = showSection;
window.goBack = goBack;
window.addToCart = addToCart;
window.openCart = openCart;
window.closeCart = closeCart;

</script>
</body>
</html>
