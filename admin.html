<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Admin ‚Äî Hotel Portal (Reworked UI)</title>
  <style>
    :root{
      --blue:#2563eb;
      --muted:#6b7280;
      --bg:#f6f8fb;
      --card:#ffffff;
      --accent:#10b981;
      --danger:#ef4444;
      --glass: rgba(255,255,255,0.8);
      font-family: Inter, Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:#0f172a;font-size:14px;line-height:1.35}
    header{
      height:56px;
      background:var(--blue);
      color:#fff;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 20px;
      position:sticky; top:0; z-index:40;
      box-shadow:0 2px 6px rgba(37,99,235,0.08);
    }
    header .brand{font-weight:700}
    header .right{display:flex;align-items:center;gap:12px;font-size:13px}
    .layout{display:flex;min-height:calc(100vh - 56px)}
    /* Sidebar */
    .sidebar{
      width:240px;
      background:var(--card);
      border-right:1px solid #eef2f6;
      padding:18px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .logo{font-weight:700;margin-bottom:6px}
    .nav-item{padding:10px 12px;border-radius:8px;color:#0f172a;display:flex;align-items:center;gap:10px;cursor:pointer}
    .nav-item:hover{background:#f1f5f9}
    .nav-item.active{background:var(--blue);color:#fff}
    .sidebar .muted{color:var(--muted);font-size:13px;margin-top:auto}
    /* Main */
    main{flex:1;padding:18px}
    .top-controls{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-bottom:14px}
    .search{flex:1;min-width:220px;display:flex;gap:8px;align-items:center}
    .search input{flex:1;padding:10px;border-radius:8px;border:1px solid #e6eef6;background:#fff}
    select, input[type="text"]{padding:9px;border-radius:8px;border:1px solid #e6eef6;background:#fff}
    button.btn{padding:8px 12px;border-radius:8px;border:0;cursor:pointer}
    button.primary{background:var(--blue);color:#fff}
    button.ghost{background:transparent;border:1px solid #e2e8f0;color:#0f172a}
    /* Cards */
    .cards{display:flex;gap:12px;margin-bottom:14px;flex-wrap:wrap}
    .card{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(2,6,23,0.04);min-width:120px;flex:1}
    .card .label{color:var(--muted);font-size:12px}
    .card .num{font-weight:700;font-size:20px;margin-top:6px}
    /* Table */
    .table-wrap{background:transparent;border-radius:10px;overflow:hidden;border:1px solid #eef2f6}
    table{width:100%;border-collapse:collapse;background:var(--card)}
    thead th{padding:12px 14px;background:#fbfdff;color:var(--muted);text-align:left;font-weight:600;border-bottom:1px solid #f1f5f9}
    tbody td{padding:14px;border-bottom:1px solid #f6f8fb;vertical-align:middle}
    tbody tr:hover td{background:#fbfcff}
    .col-small{width:64px}
    .status-badge{display:inline-block;padding:6px 8px;border-radius:999px;font-weight:700;color:#fff;font-size:13px}
    .status-Pending{background:#6b7280}
    .status-Assigned{background:var(--blue)}
    .status-In\ Progress{background:#f59e0b}
    .status-Completed{background:#16a34a}
    .status-Ignored{background:#9ca3af}
    .action-group{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .assign-select{padding:6px;border-radius:8px;border:1px solid #e6eef6}
    .btn-assign{background:var(--accent);color:#fff;padding:8px 10px;border-radius:8px;border:0;cursor:pointer}
    .btn-start{background:#f59e0b;color:#fff;padding:8px 10px;border-radius:8px;border:0}
    .btn-complete{background:#16a34a;color:#fff;padding:8px 10px;border-radius:8px;border:0}
    .btn-ignore{background:#94a3b8;color:#fff;padding:8px 10px;border-radius:8px;border:0}
    .small-muted{color:var(--muted);font-size:13px}
    /* Responsive */
    @media (max-width:1000px){
      .sidebar{display:none}
      header{padding:10px}
      .layout{flex-direction:column}
      main{padding:12px}
      .cards{flex-direction:column}
      .search{min-width:0}
    }
  </style>
</head>
<body>

<header>
  <div style="display:flex;align-items:center;gap:14px">
    <div class="brand">Hotel Admin</div>
    <div class="small-muted">Manage requests ‚Ä¢ Assign staff ‚Ä¢ Monitor performance</div>
  </div>

  <div class="right">
    <a href="index.html" style="color:#fff;text-decoration:underline">Home</a>
    <a href="login.html" style="color:#fff;text-decoration:underline">Logout</a>
  </div>
</header>

<div class="layout">

  <aside class="sidebar" role="navigation" aria-label="Admin menu">
    <div class="logo">ADMIN MENU</div>

    <div class="nav-item" data-action="analytics">üìä <span>Analytics</span></div>
    <div class="nav-item active" data-action="dashboard">üìã <span>Dashboard</span></div>
    <div class="nav-item" data-action="assignments">üßæ <span>Assignments</span></div>
    <div class="nav-item" data-action="add-staff">‚ûï <span>Add Staff</span></div>
    <div class="nav-item" data-action="add-food">üçΩ <span>Add Food Menu</span></div>
    <div class="nav-item" data-action="settings">‚öô <span>Settings</span></div>

    <div class="muted small-muted">Quick stats</div>
    <div class="small-muted" id="quickStats">Requests: 0 ¬∑ Assigned: 0 ¬∑ Ignored: 0</div>
  </aside>

  <main>
    <!-- Top filter row -->
    <div class="top-controls">
      <div class="search">
        <input id="searchInput" type="text" placeholder="Search by room, guest, service..." />
        <button class="btn ghost" id="clearSearch">Clear</button>
      </div>

      <select id="staffFilter" style="min-width:160px">
        <option value="">All Staff</option>
      </select>

      <select id="categoryFilter" style="min-width:160px">
        <option value="">All Categories</option>
        <option value="Housekeeping">Housekeeping</option>
        <option value="Travel">Travel</option>
        <option value="Food">Food</option>
      </select>

      <select id="filterStatus" style="min-width:160px">
        <option value="">All Status</option>
        <option value="Pending">Pending</option>
        <option value="Assigned">Assigned</option>
        <option value="In Progress">In Progress</option>
        <option value="Completed">Completed</option>
        <option value="Ignored">Ignored</option>
      </select>

      <button class="btn primary" id="refreshBtnTop">Refresh</button>
    </div>

    <!-- Summary cards -->
    <div class="cards" id="dashboardCards" aria-live="polite" style="margin-bottom:18px"></div>

    <!-- Requests table -->
    <div class="table-wrap">
      <table id="reqTable" aria-describedby="Requests table">
        <thead>
          <tr>
            <th class="col-small">#</th>
            <th style="width:110px">Category</th>
            <th>Service / Summary</th>
            <th style="width:110px">Guest</th>
            <th style="width:90px">Room</th>
            <th style="width:170px">Time</th>
            <th style="width:120px">Status</th>
            <th style="width:160px">Staff</th>
            <th style="width:240px">Action</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

  </main>
</div>

<script>
/* --- Storage helpers --- */
function getRequests(){ return JSON.parse(localStorage.getItem('requests') || '[]'); }
function setRequests(a){ localStorage.setItem('requests', JSON.stringify(a)); }
function getStaff(){
  const raw = localStorage.getItem('staffList');
  if(!raw){
    const defaults=[{name:'Raj',category:'Housekeeping'},{name:'Kumar',category:'Housekeeping'},{name:'Sita',category:'Housekeeping'}];
    localStorage.setItem('staffList', JSON.stringify(defaults));
    return defaults;
  }
  try{
    const parsed = JSON.parse(raw);
    if(Array.isArray(parsed) && parsed.length && typeof parsed[0] === 'string'){
      const migrated = parsed.map(s => ({ name: s, category: 'Housekeeping' }));
      localStorage.setItem('staffList', JSON.stringify(migrated));
      return migrated;
    }
    return parsed.map(p => ({ name: p.name || p, category: p.category || 'Housekeeping' }));
  }catch(e){
    return [];
  }
}
function setStaff(a){ localStorage.setItem('staffList', JSON.stringify(a)); }

/* --- UI helpers --- */
const $ = id => document.getElementById(id);
const tbody = document.querySelector('#reqTable tbody');

function statusTag(s){ return `<span class="status-badge status-${s.replace(/ /g,'-')}">${s}</span>`; }

function populateStaffFilter(){
  const el = $('staffFilter');
  const staff = getStaff();
  el.innerHTML = `<option value="">All Staff</option>` + staff.map(s=>`<option value="${s.name}">${s.name} ‚Äî ${s.category}</option>`).join('');
}
populateStaffFilter();

function updateQuickStats(){
  const all = getRequests();
  const assigned = all.filter(r=>r.status==='Assigned').length;
  const ignored = all.filter(r=>r.status==='Ignored').length;
  document.getElementById('quickStats').innerText = `Requests: ${all.length} ¬∑ Assigned: ${assigned} ¬∑ Ignored: ${ignored}`;
}

/* --- Dashboard cards --- */
function renderDashboardCards(){
  const all = getRequests();
  const pending = all.filter(r=>r.status==='Pending').length;
  const assigned = all.filter(r=>r.status==='Assigned').length;
  const inprog = all.filter(r=>r.status==='In Progress').length;
  const completed = all.filter(r=>r.status==='Completed').length;
  const ignored = all.filter(r=>r.status==='Ignored').length;

  const cards = $('dashboardCards');
  cards.innerHTML = `
    <div class="card"><div class="label">Total Requests</div><div class="num">${all.length}</div></div>
    <div class="card"><div class="label">Pending</div><div class="num">${pending}</div></div>
    <div class="card"><div class="label">Assigned</div><div class="num">${assigned}</div></div>
    <div class="card"><div class="label">In Progress</div><div class="num">${inprog}</div></div>
    <div class="card"><div class="label">Completed</div><div class="num">${completed}</div></div>
    <div class="card"><div class="label">Ignored</div><div class="num">${ignored}</div></div>
  `;
}

/* --- Table render with conditional actions --- */
function renderTable(){
  const all = getRequests();
  const search = $('searchInput').value.toLowerCase();
  const statusFilter = $('filterStatus').value;
  const staffFilter = $('staffFilter').value;
  const categoryFilter = $('categoryFilter').value;

  let filtered = all.filter(r=>{
    if(statusFilter && r.status !== statusFilter) return false;
    if(staffFilter && (r.assigned_to || '') !== staffFilter) return false;
    if(categoryFilter && r.type !== categoryFilter) return false;
    if(search){
      return (r.service||'').toLowerCase().includes(search)
        || (r.details||'').toLowerCase().includes(search)
        || (r.room||'').toString().includes(search)
        || (r.name||'').toLowerCase().includes(search)
    }
    return true;
  });

  // newest first
  filtered = filtered.slice().reverse();

  tbody.innerHTML = '';
  filtered.forEach((r, idx) => {
    const i = filtered.length - idx;
    const summary = `${r.service || '-'}${r.details ? ' ‚Äî ' + (r.details.length>80 ? r.details.slice(0,80)+'...' : r.details) : ''}`;
    const staffOptions = getStaff().filter(s => s.category === r.type).map(s=>`<option value="${s.name}" ${r.assigned_to===s.name?'selected':''}>${s.name}</option>`).join('');

    // action controls depending on status/assignment
    let actions = '';
    if(!r.assigned_to || r.status === 'Pending' || r.status === 'Ignored'){
      actions += `<select class="assign-select" data-id="${i-1}"><option value="">Assign staff</option>${staffOptions}</select>`;
      actions += `<button class="btn-assign" data-assign="${i-1}">Assign</button>`;
    } else if(r.status === 'Assigned'){
      actions += `<button class="btn-start" data-start="${i-1}">Start</button>`;
      actions += `<button class="btn-ignore" data-ignore="${i-1}">Ignore</button>`;
    } else if(r.status === 'In Progress'){
      actions += `<button class="btn-complete" data-complete="${i-1}">Complete</button>`;
      actions += `<button class="btn-ignore" data-ignore="${i-1}">Ignore</button>`;
    } else if(r.status === 'Completed'){
      actions += `<span class="small-muted">Completed</span>`;
    }

    tbody.innerHTML += `
      <tr>
        <td class="col-small">${i}</td>
        <td>${r.type || '-'}</td>
        <td><div style="font-weight:600">${summary}</div></td>
        <td>${r.name || '-'}</td>
        <td>${r.room || '-'}</td>
        <td>${r.time || ''}</td>
        <td>${statusTag(r.status || 'Pending')}</td>
        <td>${r.assigned_to ? r.assigned_to + '<div class="small-muted">'+ (getStaff().find(s=>s.name===r.assigned_to)?.category||'') +'</div>' : '-'}</td>
        <td class="action-group">${actions}</td>
      </tr>
    `;
  });

  updateQuickStats();
  renderDashboardCards();
}

/* --- Actions (Assign / Start / Complete / Ignore) --- */
document.addEventListener('click', (ev)=>{
  const all = getRequests();
  const t = ev.target;

  if(t.dataset.assign !== undefined){
    const idx = +t.dataset.assign;
    const sel = document.querySelector(`.assign-select[data-id="${idx}"]`);
    const staff = sel ? sel.value : '';
    if(!staff){ alert('Please choose a staff to assign'); return; }
    const globalIndex = getRequests().length - 1 - idx; // map to original ordering
    const requests = getRequests();
    requests[globalIndex].assigned_to = staff;
    requests[globalIndex].status = 'Assigned';
    setRequests(requests);
    renderTable();
  }

  if(t.dataset.start !== undefined){
    const idx = +t.dataset.start;
    const globalIndex = getRequests().length - 1 - idx;
    const requests = getRequests();
    requests[globalIndex].status = 'In Progress';
    setRequests(requests);
    renderTable();
  }

  if(t.dataset.complete !== undefined){
    const idx = +t.dataset.complete;
    const globalIndex = getRequests().length - 1 - idx;
    const requests = getRequests();
    requests[globalIndex].status = 'Completed';
    setRequests(requests);
    renderTable();
  }

  if(t.dataset.ignore !== undefined){
    if(!confirm('Move this request to Ignored?')) return;
    const idx = +t.dataset.ignore;
    const globalIndex = getRequests().length - 1 - idx;
    const requests = getRequests();
    requests[globalIndex].status = 'Ignored';
    setRequests(requests);
    renderTable();
  }
});

/* --- Filters and controls --- */
$('searchInput').addEventListener('input', renderTable);
$('clearSearch').addEventListener('click', ()=>{ $('searchInput').value=''; renderTable(); });
$('filterStatus').addEventListener('change', renderTable);
$('staffFilter').addEventListener('change', renderTable);
$('categoryFilter').addEventListener('change', renderTable);
$('refreshBtnTop').addEventListener('click', ()=>{ renderTable(); populateStaffFilter(); });

/* --- Initial seeds and render --- */
// Ensure sample menu & requests exist (non-destructive)
(function seed(){
  if(!localStorage.getItem('foodMenu')){
    const sample = {"Breakfast":[{name:"Idli",price:"60"},{name:"Dosa",price:"80"}],"Lunch":[{name:"Veg Thali",price:"150"}]};
    localStorage.setItem('foodMenu', JSON.stringify(sample));
  }
  renderTable();
})();

/* --- Also update staff dropdown when staff list changes externally --- */
window.addEventListener('storage', (e)=>{
  if(e.key === 'staffList') populateStaffFilter();
});

/* --- Responsive: hide sidebar action on small screens (optional) --- */
window.addEventListener('resize', ()=>{ /* extra responsive tweaks if needed */ });

</script>

</body>
</html>
