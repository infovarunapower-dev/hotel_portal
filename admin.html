<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin Dashboard ‚Äî No Staff Version</title>

<style>
*{box-sizing:border-box;font-family:Inter,Arial,Helvetica,sans-serif}
body{background:#f4f6fb;color:#0f172a;margin:0;font-size:14px}
header{height:52px;background:#2563eb;color:#fff;display:flex;align-items:center;justify-content:space-between;padding:0 16px;position:sticky;top:0;z-index:60}
header .brand{font-weight:700}
header a{color:#fff;text-decoration:underline;font-size:13px;margin-left:12px}
.layout{display:flex;min-height:calc(100vh - 52px)}
.sidebar{width:220px;background:#fff;border-right:1px solid #e6eef6;padding:14px;display:flex;flex-direction:column;gap:6px}
.sidebar h3{font-size:13px;color:#64748b;margin:0 0 8px}
.sb-item{padding:9px 10px;border-radius:6px;cursor:pointer;color:#334155;display:flex;align-items:center;gap:8px}
.sb-item:hover{background:#f1f5f9}
.sb-item.active{background:#2563eb;color:#fff}
main{flex:1;padding:14px}
.controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:12px}
.controls .search{flex:1;min-width:200px;display:flex;gap:6px}
.controls input[type="text"]{flex:1;padding:8px;border-radius:8px;border:1px solid #e6edf6;background:#fff}
.controls select,.controls button{padding:8px;border-radius:8px;border:1px solid #e6edf6;background:#fff}
.card{background:#fff;padding:10px;border-radius:8px;flex:1;min-width:120px;box-shadow:0 6px 18px rgba(2,6,23,0.04)}
.table-wrap{background:#fff;border-radius:10px;overflow:hidden;border:1px solid #e6eef6}
table{width:100%;border-collapse:collapse}
thead th{background:#fbfdff;padding:10px 12px;color:#64748b;text-align:left;font-weight:600;border-bottom:1px solid #f1f5f9}
tbody td{padding:10px 12px;border-bottom:1px solid #f6f8fb;vertical-align:middle}
tbody tr:hover td{background:#fbfcff}
.status-badge{display:inline-block;padding:6px 8px;border-radius:999px;color:#fff;font-weight:700;font-size:12px}
.status-Pending{background:#6b7280}
.status-InProgress{background:#f59e0b}
.status-Completed{background:#16a34a}
.status-Ignored{background:#94a3b8}
.btn{padding:7px 12px;border-radius:6px;border:0;color:#fff;cursor:pointer;font-size:13px}
.btn-next{background:#2563eb}
.btn-ignore{background:#6b7280}
.btn-delete{background:#ef4444}
.btn-ghost{background:#fff;border:1px solid #e2e8f0;color:#334155}
.action-group{display:flex;gap:8px;flex-wrap:wrap}
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.35);display:none;align-items:center;justify-content:center;z-index:2000}
.modal{background:#fff;padding:16px;border-radius:10px;max-width:520px;width:94%;box-shadow:0 12px 30px rgba(2,6,23,0.12)}
.small-muted{font-size:12px;color:#6b7280}
</style>
</head>

<body>

<header>
    <div class="brand">Admin Dashboard</div>
    <div>
        <a href="index.html">Home</a>
        <a href="login.html">Logout</a>
    </div>
</header>

<div class="layout">

<!-- SIDEBAR -->
<aside class="sidebar">
    <h3>ADMIN MENU</h3>
    <div class="sb-item active" data-action="dashboard">üìã Dashboard</div>
    <div class="sb-item" data-action="food-menu">üçΩ Food Menu</div>
    <div class="sb-item" data-action="settings">‚öô Settings</div>
</aside>

<!-- MAIN -->
<main>

<div class="controls">
    <div class="search">
        <input id="searchInput" type="text" placeholder="Search room, guest, service, details...">
        <button id="clearSearch" class="btn-ghost">Clear</button>
    </div>

    <select id="categoryFilter">
        <option value="">All Categories</option>
        <option>Housekeeping</option>
        <option>Travel</option>
        <option>Food</option>
    </select>

    <select id="statusFilter">
        <option value="">All Status</option>
        <option>Pending</option>
        <option>In Progress</option>
        <option>Completed</option>
        <option>Ignored</option>
    </select>

    <button id="refreshBtn" class="btn-ghost">Refresh</button>
</div>

<!-- TABLE -->
<div class="table-wrap" id="dashboardView">
    <table id="reqTable">
        <thead>
            <tr>
                <th>#</th>
                <th>Category</th>
                <th>Service / Details</th>
                <th>Guest</th>
                <th>Room</th>
                <th>Time</th>
                <th>Scheduled</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<!-- Food page stub (will navigate to actual food.html if clicked) -->
<div id="foodView" class="table-wrap" style="display:none;">
  <div style="padding:18px">
    <h3 style="margin:0 0 8px">Food Menu (Admin)</h3>
    <p class="small-muted">Click the button below to open the food menu editor / preview.</p>
    <div style="margin-top:12px">
      <button id="openFoodBtn" class="btn-ghost">Open Food Page</button>
    </div>
  </div>
</div>

</main>
</div>

<!-- Simple modal used by settings -->
<div id="modalBackdrop" class="modal-backdrop">
  <div id="modalBox" class="modal"></div>
</div>

<script>
// Load & save
function load(){ return JSON.parse(localStorage.getItem("requests") || "[]"); }
function save(d){ localStorage.setItem("requests", JSON.stringify(d)); }

// Format scheduled field safely
function formatScheduled(s){
    if(!s) return "";
    if(s === "ASAP") return "ASAP";
    const d = new Date(s);
    if(!isNaN(d)) return d.toLocaleString();
    return String(s);
}

// Render table
function renderTable(){
    const all = load();
    const tbody = document.querySelector("#reqTable tbody");
    tbody.innerHTML = "";

    const search = searchInput.value.toLowerCase();
    const cat = categoryFilter.value;
    const status = statusFilter.value;

    all.forEach((r, i) => {
        if(cat && r.type !== cat) return;
        if(status && r.status !== status) return;

        const hay = `${r.service} ${r.details || ""} ${r.room || ""} ${r.name || ""}`.toLowerCase();
        if(search && !hay.includes(search)) return;

        const nextBtn =
            r.status === "Pending" ? "Start" :
            r.status === "In Progress" ? "Complete" :
            "";

        const scheduledText = formatScheduled(r.scheduled_at);

        tbody.insertAdjacentHTML("beforeend", `
        <tr>
            <td>${i+1}</td>
            <td>${r.type || ""}</td>
            <td>${r.service || ""} ${r.details ? '‚Äî <small class="small-muted">'+(r.details||"")+'</small>' : ''}</td>
            <td>${r.name || "Guest"}</td>
            <td>${r.room || ""}</td>
            <td>${r.created_at ? (new Date(r.created_at).toLocaleString()) : (r.time||"")}</td>
            <td>${scheduledText}</td>
            <td><span class="status-badge status-${(r.status||'').replace(" ","")}">${r.status || ""}</span></td>
            <td>
                <div class="action-group">
                    ${nextBtn ? `<button class="btn btn-next" data-next="${i}">${nextBtn}</button>` : ""}
                    <button class="btn btn-ignore" data-ignore="${i}">Ignore</button>
                    <button class="btn btn-delete" data-delete="${i}">Delete</button>
                </div>
            </td>
        </tr>
        `);
    });
}

// Next step workflow
document.addEventListener("click", e => {
    const all = load();

    if(e.target.dataset.next){
        const i = +e.target.dataset.next;
        if(!all[i]) return;
        if(all[i].status === "Pending") all[i].status = "In Progress";
        else if(all[i].status === "In Progress") all[i].status = "Completed";
        all[i].updated_at = new Date().toISOString();
        save(all);
        renderTable();
    }

    if(e.target.dataset.ignore){
        const i = +e.target.dataset.ignore;
        if(!all[i]) return;
        all[i].status = "Ignored";
        all[i].updated_at = new Date().toISOString();
        save(all);
        renderTable();
    }

    if(e.target.dataset.delete){
        const i = +e.target.dataset.delete;
        if(!all[i]) return;
        all.splice(i,1);
        save(all);
        renderTable();
    }
});

// Filters & actions
searchInput.addEventListener("input", renderTable);
categoryFilter.addEventListener("change", renderTable);
statusFilter.addEventListener("change", renderTable);
clearSearch.addEventListener("click", ()=>{ searchInput.value=""; renderTable(); });
refreshBtn.addEventListener("click", renderTable);

// =============== Sidebar navigation handling ===============
// Adds click handling to sidebar items via data-action attributes
document.querySelectorAll('.sb-item').forEach(item=>{
  item.addEventListener('click', ()=> {
    // visual active toggle
    document.querySelectorAll('.sb-item').forEach(s => s.classList.remove('active'));
    item.classList.add('active');

    const action = item.dataset.action;
    if(action === 'dashboard'){
      // show dashboard view
      document.getElementById('dashboardView').style.display = '';
      document.getElementById('foodView').style.display = 'none';
      // ensure table refreshed
      renderTable();
    } else if(action === 'food-menu'){
      // show a lightweight admin food view and provide a button to open the full food page
      document.getElementById('dashboardView').style.display = 'none';
      document.getElementById('foodView').style.display = '';
    } else if(action === 'settings'){
      // open settings modal
      openSettingsModal();
    }
  });
});

// Food view button (opens the actual food.html page)
document.getElementById('openFoodBtn').addEventListener('click', ()=> {
  // open food management page in a new tab for editing/preview
  window.open('food.html', '_blank');
});

// ================= Settings modal =================
function openSettingsModal(){
  const html = `
    <h3 style="margin:0 0 10px">Settings</h3>
    <p class="small-muted">Admin settings ‚Äî quick actions</p>
    <div style="margin-top:12px">
      <button id="clearReq" class="btn-ghost" style="margin-right:8px">Clear All Requests</button>
      <button id="exportReq" class="btn-ghost">Export Requests (JSON)</button>
    </div>
    <div style="margin-top:12px" class="small-muted">Close this modal when done.</div>
  `;
  openModal(html);

  document.getElementById('clearReq').addEventListener('click', ()=>{
    if(confirm('Clear ALL requests? This cannot be undone.')) {
      localStorage.removeItem('requests');
      renderTable();
      closeModal();
      alert('All requests cleared.');
    }
  });

  document.getElementById('exportReq').addEventListener('click', ()=>{
    const data = JSON.stringify(load(), null, 2);
    const blob = new Blob([data], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'requests.json';
    a.click();
  });
}

// Modal helpers
function openModal(html){
  document.getElementById('modalBox').innerHTML = html;
  document.getElementById('modalBackdrop').style.display = 'flex';
}
function closeModal(){
  document.getElementById('modalBackdrop').style.display = 'none';
  document.getElementById('modalBox').innerHTML = '';
}

// Init
renderTable();
</script>

</body>
</html>
